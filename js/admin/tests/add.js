// Generated by CoffeeScript 1.4.0
var qestion;

qestion = {
  init: function() {},
  showModal: function(question_id) {
    var modal;
    modal = $('#questionModal');
    return $.ajax({
      url: SYS.baseUrl + 'admin/tests/get_form_question',
      type: 'POST',
      dataType: 'JSON',
      data: $.param({
        question_id: question_id
      }),
      success: function(res) {
        var _this = this;
        if (res.text === 'success') {
          modal.find('.modal-body').html(res.data.form_question);
          window.question = new QuestionBuilder($('#question-edit'));
          $('.delete-image').unbind("click");
          $('.delete-image').click(function(e) {
            var btn, img;
            btn = $(e.target);
            img = btn.prev('.question-img-container');
            img.attr("src", SYS.baseUrl + 'img/white.jpg');
            btn.parents('.add_q').find("input[name='question[image]']").val('');
            return btn.hide();
          });
          $('.answers_container').find('div.row').each(function(key, el) {
            var new_answer;
            new_answer = new Answer($(el));
            return new_answer.bindAfter();
          });
          if (question.getQuestionType() === 'write') {
            question.elemets.section_answers.hide();
          }
          modal.on("show", function() {
            $('.fixed').css({
              display: "block"
            });
            $('body').css({
              overflow: "hidden"
            });
            return $('.modal-backdrop').show();
          });
          modal.modal();
          return modal.on("hide", function() {
            $('.modal-backdrop').hide();
            window.question = new QuestionBuilder($('#question-form'));
            return modal.find('.modal-body').html('');
          });
        }
      }
    });
  },
  move: function(question_id, level_id, el) {
    if (confirm("Переместить вопрос?")) {
      return $.ajax({
        url: SYS.baseUrl + 'admin/tests/move_qestion',
        type: 'POST',
        dataType: 'JSON',
        data: $.param({
          question_id: question_id,
          level_id: level_id
        }),
        success: function(res) {
          if (res.text === 'success') {
            $(el).parents('div.question').fadeOut('fast');
            return Alert.factory().setMessage("Вопрос успешно перемещен!").render();
          }
        }
      });
    }
  },
  remove: function(question_id, el) {
    if (confirm("Удалить вопрос?")) {
      return $.ajax({
        url: SYS.baseUrl + 'admin/tests/remove_qestion',
        type: 'POST',
        dataType: 'JSON',
        data: $.param({
          question_id: question_id
        }),
        success: function(res) {
          if (res.text === 'success') {
            $(el).parents('div.question').fadeOut('fast');
            return Alert.factory().setMessage("Вопрос успешно удален!").render();
          }
        }
      });
    }
  }
};

$(document).ready(function() {
  var _this = this;
  qestion.init();
  window.question = new QuestionBuilder($("#question-form"));
  return $('.answers_container').find('div.row').each(function(key, el) {
    var new_answer;
    new_answer = new Answer($(el));
    return new_answer.bindAfter();
  });
});
